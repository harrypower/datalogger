<!DOCTYPE html>
<HTML>
<HEAD>  
<meta charset="utf-8">
<TITLE>Temperature Charting</TITLE>  
</HEAD>  
<BODY>  
<$
 
include ../string.fs
include ../Gforth-Tools/sqlite3_gforth_lib.fs
decimal

variable datalogger_path$
variable dbpath$
variable junks$
variable xlables$
variable templables$
variable humdlables$
variable presslables$

s" /var/lib/datalogger-gforth/datalogger_home_path" slurp-file datalogger_path$ $!
s" /collection/sensordb.data" datalogger_path$ $@ junks$ $! junks$ $+!
junks$ $@ dbname
junks$ $@ dbpath$ $!


s" " dbrecordseparator

10000 mkretbuff

: getlableslast
    s\" \",\"" dbfieldseparator
    s" select datetime(dtime,'unixepoch','localtime') from thpdata limit 50 offset ((select max(rowid) from thpdata) -50);" dbcmds
    sendsqlite3cmd dbret$ 2 -
    s\" \"" junks$ $! junks$ $+! junks$ $@ xlables$ $! ;
 
: gettemplast
    s" ," dbfieldseparator
    s" select ((DTHtemperature / 10)+((DTHtemperature % 10)*0.1)) from thpdata limit 50 offset ((select max(rowid) from thpdata) -50);" dbcmds
    sendsqlite3cmd dbret$ 1 -  templables$ $! ;

: gethumdlast
    s" ," dbfieldseparator
    s" select ((DTHhumd / 10)+((DTHhumd % 10)*0.1)) from thpdata limit 50 offset ((select max(rowid) from thpdata)-50);" dbcmds
    sendsqlite3cmd drop dbret$ 1 - humdlables$ $! ;

: getpresslast
    s" ," dbfieldseparator
    s" select ((BMPpressure / 10)+((BMPpressure % 10)*0.1)) from thpdata limit 50 offset ((select max(rowid) from thpdata)-50);" dbcmds
    sendsqlite3cmd drop dbret$ 1 - presslables$ $! ;

getlableslast
gettemplast
gethumdlast
getpresslast

$>

<script src="../chart/Chart.js"></script>
<canvas id="tempChart" width=1400" height="300"></canvas>

<script>

var tempoptions = { pointDotRadius : 2, scaleFontColor : "#572", scaleFontFamily : "'Comic Sans MS'", scaleFontStyle : "bold" };
  
  var tempdata = {
  labels : [ <$ xlables$ $@ type $> ],
    datasets : [
    {
    fillColor : "rgba(120,220,250,0.5)",
    strokeColor : "rgba(220,220,220,1)",
    pointColor : "rgba(220,220,220,1)",
    pointStrokeColor : "#fff",
    data : [ <$ templables$ $@ type $> ]
      }
      ]
      }

      //Get the context of the canvas element we want to select
      var tempctx = document.getElementById("tempChart").getContext("2d");
      var mytempChart = new Chart(tempctx).Line(tempdata,tempoptions);

</script>

<script src="../chart/Chart.js"></script>
<canvas id="humdChart" width=1400" height="300"></canvas>
	  
<script>
  
  var humdoptions = { 'pointDotRadius':2 , scaleFontColor : "#572", scaleFontFamily : "'Comic Sans MS'", scaleFontStyle : "bold" };

  var humddata = {
  labels : [ <$ xlables$ $@ type $> ],
    datasets : [
    {
    fillColor : "rgba(120,220,250,0.5)",
    strokeColor : "rgba(220,220,220,1)",
    pointColor : "rgba(220,220,220,1)",
    pointStrokeColor : "#fff",
    data : [ <$ humdlables$ $@ type $> ]
      }
      ]
      }
      
      //Get the context of the canvas element we want to select
      var humdctx = document.getElementById("humdChart").getContext("2d");
      var myhumdChart = new Chart(humdctx).Line(humddata,humdoptions);
      
</script>

<script src="../chart/Chart.js"></script>
<canvas id="pressureChart" width=1400" height="300"></canvas>
	  
<script>
  
  var pressoptions = { 'pointDotRadius':2 , scaleFontColor : "#572", scaleFontFamily : "'Comic Sans MS'", scaleFontStyle : "bold" };
  
  var pressuredata = {
  labels : [ <$ xlables$ $@ type $> ],
    datasets : [
    {
    fillColor : "rgba(120,220,250,0.5)",
    strokeColor : "rgba(220,220,220,1)",
    pointColor : "rgba(220,220,220,1)",
    pointStrokeColor : "#fff",
    data : [ <$ presslables$ $@ type $> ]
      }
      ]
      }
      
      //Get the context of the canvas element we want to select
      var pressurectx = document.getElementById("pressureChart").getContext("2d");
      var mypressChart = new Chart(pressurectx).Line(pressuredata,pressoptions);
      
</script>
		    
<P>url-args are :  <$ url-args $@ type url-args $@ swap drop  ." amounts:" . $>  </P>
    
</BODY>  
</HTML>

