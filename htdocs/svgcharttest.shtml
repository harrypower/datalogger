<!Doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Some svg stuff</title>
</head>
<$
require ../collection/sqlite3-stuff.fs
require ../collection/svgmaker.fs
decimal

$>
<body>
<$

list$: somedata
list$: dataholder1
list$: dataholder2
list$: xlabledata

create mydata 2 chartdata% %size * allot 
create myattr chartattr% %allot drop

list$: dattr$
list$: cattr$
list$: ltxt$
list$: lline$
list$: xltxt$


s" 30" somedata-$!
s" 40" somedata-$!
s" 25" somedata-$!
s" 50" somedata-$!
s" 35" somedata-$!
s" 100" somedata-$!
s" -20" somedata-$!
s" 0"   somedata-$!
s" -100" somedata-$!

variable art$
: fill-labletxt ( -- )
    somedata swap drop 0 do
	i #to$ xlabledata-$!
    loop ;
fill-labletxt

' somedata   mydata data-xt% !
' xlabledata myattr xlable-data-xt% !
svg-attr#1 svgattr dattr$->$! 
' dattr$    mydata data-attr-xt% !
svg-attr#2 svgattr cattr$->$!
' cattr$    mydata circle-attr-xt% !
svg-attrtext svgattr ltxt$->$!
' ltxt$     myattr ylabtxt-attr-xt% !
svg-attr#3 svgattr lline$->$!
' lline$    myattr labline-attr-xt% !
svg-attrtext svgattr xltxt$->$!
' xltxt$    myattr xlabtxt-attr-xt% !
5 to ylablerot
70 to xlablerot

myattr mydata 1 makesvgchart false = [if] type [else] 2drop [then]

." depth is: " depth .
." fdepth is: " fdepth .
setupsqlite3
s"  " dbrecordseparator 
s" " dbfieldseparator
64000 mkretbuff
: getstuff ( -- ) 
    s" select temperature from mbedA;" dbcmds
    sendsqlite3cmd . ."   db errors "
    dbret$
    begin
	32 $split
	2swap dataholder1-$!
	dup 0 = 
    until
    2drop
    s" select humidity from mbedA;" dbcmds
    sendsqlite3cmd . ."  db errors "
    dbret$
    begin
	32 $split
	2swap dataholder2-$!
	dup 0 =
    until
    2drop ;
getstuff

dataholder1 swap drop . ."  dh1 "
dataholder2 swap drop . ."  dh2 "

svg-attr#1 svgattr dattr$->$! 
' dattr$ mydata data-attr-xt% 1 chartdata% %size * + !

svg-attr#2 svgattr cattr$->$! 
' cattr$ mydata circle-attr-xt% 1 chartdata% %size * + !


' dataholder1 mydata data-xt% 0 chartdata% %size * + !
' dataholder2 mydata data-xt% 1 chartdata% %size * + !
50 to xlablerot
xltxt$-$off
svg-attrtext svgattr xltxt$->$!
\ s\" style=\"writing-mode: tb; glyph-orientation-vertical: 0;\"" xltxt$-$!

' xltxt$    myattr xlabtxt-attr-xt% !

15 to xminstep
1500 to xmaxchart
xlabledata-$off
: fill-nextlabletxt ( -- )
    xmaxchart xminstep / 0 do
	i #to$ xlabledata-$!
    loop ;
fill-nextlabletxt
 ' xlabledata myattr xlable-data-xt% !

xlabledata swap drop . ."  xlabledata" 
myattr mydata 2 makesvgchart false = [if] type [else] 2drop [then]
mymin f@ f. ."  " mymax f@ f. ."  " xmaxpoints . ."  maxpoints"

dataholder1 2drop 
: looksee ( ncount -- )
    0 do
	dataholder1-$@ type ." :" 
    loop ;
   
 s" mbedA" get-table>fields throw 
 field$s-$@ type ."  "
 field$s-$@ type ."  " 
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
." depth is: " depth .
." fdepth is: " fdepth .
 xmaxpoints looksee
svgdata$-$off
s" M 10.3 30.8" svgdata$-$!
s" L 15.8 35.7" svgdata$-$!
s" L 97 80.8" svgdata$-$!
s" L 83 9.372" svgdata$-$!
init-svg-header
svg-attr#1
' svgattrn ' svgattrv ' svgheadern ' svgheaderv ' svgdata$ make-a-pathsvg type

$>

</body>
</html>
