<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Last data</title>
</head>
<$
include ../string.fs
include ../Gforth-Tools/sqlite3_gforth_lib.fs
decimal

variable datalogger_path$
variable dbpath$
variable junks$


s" /var/lib/datalogger-gforth/datalogger_home_path" slurp-file datalogger_path$ $!
s" /collection/sensordb.data" datalogger_path$ $@ junks$ $! junks$ $+!
junks$ $@ dbname
junks$ $@ dbpath$ $!

s" </td><td>" dbfieldseparator
s" </td></tr><tr><td>" dbrecordseparator
10000 mkretbuff


: getrows
    s" select datetime(dtime,'unixepoch','localtime'),((DTHtemperature/10)+((DTHtemperature%10)*0.1)),((DTHhumd/10)+((DTHhumd%10)*0.1)),BMPpressure from thpdata  "
   junks$ $!
   s"  limit 100 offset ((select max(rowid) from thpdata) -100);" junks$ $+! junks$ $@
   dbcmds sendsqlite3cmd dbret$ type ;

$>
<body>
<h1>List of last 100 data points</h1>
    <table cellspacing="20">
    <tr> <td>Date</td><td>Temperature in C</td><td>Humidity in rH</td><td>Pressure in pa</td><td></td></tr>
<tr> <td>
<$ getrows $> </td> <td></td><td></td><td></td><td></td></tr>
</table>
</body>
</html>
