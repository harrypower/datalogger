<!DOCTYPE html>
<HTML>
<HEAD>  
<meta charset="utf-8">
<TITLE>Temperature Charting</TITLE>  
</HEAD>  
<BODY>  

<script src="../chart/Chart.js"></script>
<canvas id="gforthChart" width="800" height="400"></canvas>

<$
 
include ../string.fs
include ../Gforth-Tools/sqlite3_gforth_lib.fs
decimal

variable datalogger_path$
variable dbpath$
variable junks$


s" /var/lib/datalogger-gforth/datalogger_home_path" slurp-file datalogger_path$ $!
s" /collection/sensordb.data" datalogger_path$ $@ junks$ $! junks$ $+!
junks$ $@ dbname
junks$ $@ dbpath$ $!


s" " dbrecordseparator

10000 mkretbuff

: -NULL$ ( caddr u -- caddr u1 ) \ the first null found causes string to be cut at that point
    2dup  s"  " over 0 swap c! search if swap drop - else 2drop then ;

\ : getlables s" 1389317384,1389317684,"  ;
\ : getdata  s" 40,50,"  ;
 : getlables 
     s" select dtime from thpdata limit 50 offset ((select max(rowid) from thpdata) -50);" dbcmds
     sendsqlite3cmd dbret$ -NULL$ ;
 
 : getdata
    s" select DTHtemperature from thpdata limit 50 offset ((select max(rowid) from thpdata) -50);" dbcmds
    sendsqlite3cmd dbret$  -NULL$  ;

\ getdata -$zero swap drop . cr  
\ getlables swap drop . cr
 
$>

<script>

var options = { 'pointDotRadius':2 };

var gforthdata = {
	labels : [ <$ getlables type $> ],
	datasets : [
		{
			fillColor : "rgba(220,220,220,0.5)",
			strokeColor : "rgba(220,220,220,1)",
			pointColor : "rgba(220,220,220,1)",
			pointStrokeColor : "#fff",
			data : [ <$ getdata type $> ]
		}
	]
}

//Get the context of the canvas element we want to select
var gforthctx = document.getElementById("gforthChart").getContext("2d");
var mygforthChart = new Chart(gforthctx).Line(gforthdata,options);

</script>

</BODY>  
</HTML>

