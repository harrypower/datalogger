<!DOCTYPE html>
<HTML>
<HEAD>  
<meta charset="utf-8">
<TITLE>Temperature Charting</TITLE>  
</HEAD>  
<BODY>  

<script src="../chart/Chart.js"></script>
<canvas id="gforthChart" width=1800" height="400"></canvas>

<$
 
include ../string.fs
include ../Gforth-Tools/sqlite3_gforth_lib.fs
decimal

variable datalogger_path$
variable dbpath$
variable junks$


s" /var/lib/datalogger-gforth/datalogger_home_path" slurp-file datalogger_path$ $!
s" /collection/sensordb.data" datalogger_path$ $@ junks$ $! junks$ $+!
junks$ $@ dbname
junks$ $@ dbpath$ $!


s" " dbrecordseparator

10000 mkretbuff

: getlables
    s\" \",\"" dbfieldseparator
    s" select datetime(dtime,'unixepoch','localtime') from thpdata limit 50 offset ((select max(rowid) from thpdata) -50);" dbcmds
    sendsqlite3cmd dbret$ 2 -
    s\" \"" junks$ $! junks$ $+! junks$ $@ ;
 
: getdata
    s" ," dbfieldseparator
    s" select ((DTHtemperature / 10)+((DTHtemperature % 10)*0.1)) from thpdata limit 50 offset ((select max(rowid) from thpdata) -50);" dbcmds
    sendsqlite3cmd dbret$ 1 -  ;

$>

<script>

var options = { 'pointDotRadius':2 };

var gforthdata = {
	labels : [ <$ getlables type $> ],
	datasets : [
		{
			fillColor : "rgba(120,220,250,0.5)",
			strokeColor : "rgba(220,220,220,1)",
			pointColor : "rgba(220,220,220,1)",
			pointStrokeColor : "#fff",
			data : [ <$ getdata type $> ]
		}
	]
}

//Get the context of the canvas element we want to select
var gforthctx = document.getElementById("gforthChart").getContext("2d");
var mygforthChart = new Chart(gforthctx).Line(gforthdata,options);

</script>

</BODY>  
</HTML>

