<!Doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Some svg stuff</title>
</head>
<$
require ../collection/sqlite3-stuff.fs
require ../collection/svgmaker.fs
decimal

list$: somedata
s" 30" somedata-$!
s" 40" somedata-$!
s" 25" somedata-$!
s" 50" somedata-$!
s" 35" somedata-$!
s" 100" somedata-$!
s" -20" somedata-$!
s" 0" somedata-$!
s" -100" somedata-$!

$>
<body>
<$
create mydata chartdata% %allot drop
create myattr chartattr% %allot drop
list$: dattrn$
list$: dattrv$
list$: cattrn$
list$: cattrv$
list$: ltxtn$
list$: ltxtv$
list$: llinen$
list$: llinev$

' somedata mydata data-xt% !
svg-attr#1 svgattrn dattrn$->$! svgattrv dattrv$->$!
' dattrn$ mydata data-attr-name-xt% !
' dattrv$ mydata data-attr-value-xt% !
svg-attr#2 svgattrn cattrn$->$! svgattrv cattrv$->$!
' cattrn$ mydata circle-attr-name-xt% !
' cattrv$ mydata circle-attr-value-xt% !
svg-attrtext svgattrn ltxtn$->$! svgattrv ltxtv$->$!
' ltxtn$ myattr ylabtxt-attr-name-xt% !
' ltxtv$ myattr ylabtxt-attr-value-xt% !
svg-attr#3 svgattrn llinen$->$! svgattrv llinev$->$!
' llinen$ myattr labline-attr-name-xt% !
' llinev$ myattr labline-attr-value-xt% !
myattr mydata 1 makesvgchart false = [if] type [else] 2drop [then]
." depth is: " depth .
." fdepth is: " fdepth .
setupsqlite3
s"  " dbrecordseparator 
s" " dbfieldseparator
64000 mkretbuff
list$: dataholder
: getstuff 
\ s" select temperature from mbedA where (row(id) > ( select max(rowid) from mbedA - 100 ));"  dbcmds
s" select nh3raw from mbedA;" dbcmds
    sendsqlite3cmd . ."   db errors "
    dbret$
begin
  32 $split
  2swap dataholder-$!
  dup 0 = 
until
2drop
;
getstuff
dataholder swap drop .
' dataholder mydata data-xt% !
myattr mydata 1 makesvgchart false = [if] type [else] 2drop [then]
mymin . ."  " mymax . ."  " 
dataholder 2drop 
: looksee ( ncount -- )
    0 do
	dataholder-$@ type ." :" 
    loop ;
   
 s" mbedA" get-table>fields throw 
 field$s-$@ type ."  "
 field$s-$@ type ."  " 
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
 field$s-$@ type ."  "
." depth is: " depth .
." fdepth is: " fdepth .
\ xmaxpoints looksee
svgdata$-$off
s" M 10.3 30.8" svgdata$-$!
s" L 15.8 35.7" svgdata$-$!
s" L 97 80.8" svgdata$-$!
s" L 83 9.372" svgdata$-$!
init-svg-header
svg-attr#1
' svgattrn ' svgattrv ' svgheadern ' svgheaderv ' svgdata$ make-a-pathsvg type

somedata-$off
\ s" stuff" somedata-$!
s" 30.8" somedata-$!
s" 35.7" somedata-$!
s" 80.8" somedata-$!
s" 9.372" somedata-$!
\ s" stuff" somedata-$!
s" -48.32" somedata-$!
' somedata mydata data-xt% !
myattr mydata 1 makesvgchart false = [if] type [else] 2drop [then]
." mymax is:" mymax f@ f.
." mymin is:" mymin f@ f.
." depth is: " depth .
." fdepth is: " fdepth .

somedata-$off
\ s" stuff" somedata-$!
 s" 1.3" somedata-$!
s" 1.457" somedata-$!
\ s" stuff" somedata-$!
s" 1.808" somedata-$!
s" 1.9372" somedata-$!
 s" 1.7" somedata-$!
' somedata mydata data-xt% !
myattr mydata 1 makesvgchart false = [if] type [else] 2drop [then]

." depth is: " depth .
." fdepth is: " fdepth .

list$:  otherdata
s" 2.5" otherdata-$!
s" 5"   otherdata-$!
s" 1.7" otherdata-$!
 s" 4"   otherdata-$!
\ s" 4.5" otherdata-$!
s" 6.8" otherdata-$!
\ s" 5.3" otherdata-$!
create mydata2 2 chartdata% %size * allot 
list$: dattrn1$
list$: dattrv1$
list$: cattrn1$
list$: cattrv1$

' somedata mydata2 data-xt% 0 chartdata% %size * + !
' otherdata mydata2 data-xt% 1 chartdata% %size * + !
svg-attr#1 svgattrn dattrn$->$! svgattrv dattrv$->$!
' dattrn$ mydata2 data-attr-name-xt% 0 chartdata% %size * + !
' dattrv$ mydata2 data-attr-value-xt% 0 chartdata% %size * + !
svg-attr#1 svgattrn dattrn1$->$! svgattrv dattrv1$->$!
' dattrn1$ mydata2 data-attr-name-xt% 1 chartdata% %size * + !
' dattrv1$ mydata2 data-attr-value-xt% 1 chartdata% %size  * + !
svg-attr#2 svgattrn cattrn$->$! svgattrv cattrv$->$!
' cattrn$ mydata2 circle-attr-name-xt% 0 chartdata% %size * + !
' cattrv$ mydata2 circle-attr-value-xt% 0 chartdata% %size * + !
svg-attr#2 svgattrn cattrn1$->$! svgattrv cattrv1$->$!
' cattrn1$ mydata2 circle-attr-name-xt% 1 chartdata% %size * + !
' cattrv1$ mydata2 circle-attr-value-xt% 1 chartdata% %size * + !
 myattr mydata2 2 makesvgchart false = [if] type [else] 2drop [then]  

." depth2 is: " depth .
." fdepth2 is: " fdepth .
." max is:" mymax f@ f.
." min is:" mymin f@ f.

$>

</body>
</html>
